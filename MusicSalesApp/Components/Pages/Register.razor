@page "/register"
@inherits RegisterModel

<PageTitle>Register</PageTitle>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <SfCard>
                <CardHeader Title="@(showVerificationSection ? "Email Verification Required" : "Create Account")" />
                <CardContent>
                    @if (!string.IsNullOrEmpty(successMessage))
                    {
                        <SfMessage Severity="MessageSeverity.Success">@successMessage</SfMessage>
                    }
                    @if (!string.IsNullOrEmpty(errorMessage))
                    {
                        <SfMessage Severity="MessageSeverity.Error">@errorMessage</SfMessage>
                    }
                    @if (!string.IsNullOrEmpty(infoMessage))
                    {
                        <SfMessage Severity="MessageSeverity.Info">@infoMessage</SfMessage>
                    }

                    @if (showVerificationSection)
                    {
                        <div class="mb-4">
                            <p>A verification email has been sent to <strong>@Email</strong>.</p>
                            <p>Please check your email and click the verification link to complete your registration. The link will expire in <strong>10 minutes</strong>.</p>
                            
                            @if (!canResendEmail)
                            {
                                <p class="text-muted">You can request a new verification email in @FormatRemainingTime(secondsRemaining).</p>
                            }
                        </div>

                        <div class="d-grid gap-2">
                            <SfButton OnClick="ResendVerificationEmail"
                                    Disabled="@(!canResendEmail || isSubmitting)"
                                    IsPrimary="true"
                                    Content="@(isSubmitting ? "Sending..." : "Resend Verification Email")"
                                    CssClass="e-btn e-primary" />
                        </div>

                        <hr class="my-4" />

                        <h5>Change Email Address</h5>
                        <p class="text-muted">Made a typo? Update your email address below:</p>
                        
                        <div class="mb-3">
                            <label for="newEmail" class="e-label">New Email Address</label>
                            <SfTextBox ID="newEmail" @bind-Value="NewEmail" Placeholder="Enter new email" CssClass="e-outline" />
                        </div>
                        <SfButton OnClick="ChangeEmail" Disabled="@isSubmitting" Content="@(isSubmitting ? "Updating..." : "Update Email & Send New Verification")" CssClass="e-btn e-outline w-100" />
                    }
                    else
                    {
                        <EditForm Model="this" OnValidSubmit="HandleSubmit">
                            <DataAnnotationsValidator />
                            <ValidationSummary />

                            <div class="mb-3">
                                <label for="email" class="e-label">Email</label>
                                <InputText id="email" class="form-control" @bind-Value="Email" />
                            </div>
                            <div class="mb-3">
                                <label for="password" class="e-label">Password</label>
                                <InputText id="password" class="form-control" type="password" @bind-Value="Password" />
                                <small class="text-muted">Must be at least 8 characters and include upper, lower, digit, and symbol.</small>
                            </div>
                            <div class="mb-3">
                                <label for="confirm" class="e-label">Confirm Password</label>
                                <InputText id="confirm" class="form-control" type="password" @bind-Value="ConfirmPassword" />
                            </div>
                            <SfButton Type="ButtonType.Submit" IsPrimary="true" Disabled="@isSubmitting" Content="@(isSubmitting ? "Please wait..." : "Register")" CssClass="e-btn e-primary w-100" />
                        </EditForm>
                    }
                </CardContent>
            </SfCard>
            <div class="mt-3 text-center">
                <a href="/login">Already have an account? Login</a>
            </div>
        </div>
    </div>
</div>

