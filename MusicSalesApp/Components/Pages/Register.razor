@page "/register"
@inherits RegisterModel
@rendermode InteractiveServer

<PageTitle>Register</PageTitle>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header"><h3>@(showVerificationSection ? "Email Verification Required" : "Create Account")</h3></div>
                <div class="card-body">
                    @if (!string.IsNullOrEmpty(successMessage))
                    {
                        <div class="alert alert-success">@successMessage</div>
                    }
                    @if (!string.IsNullOrEmpty(errorMessage))
                    {
                        <div class="alert alert-danger">@errorMessage</div>
                    }
                    @if (!string.IsNullOrEmpty(infoMessage))
                    {
                        <div class="alert alert-info">@infoMessage</div>
                    }

                    @if (showVerificationSection)
                    {
                        <div class="mb-4">
                            <p>A verification email has been sent to <strong>@Email</strong>.</p>
                            <p>Please check your email and click the verification link to complete your registration. The link will expire in <strong>10 minutes</strong>.</p>
                            
                            @if (!canResendEmail)
                            {
                                <p class="text-muted">You can request a new verification email in @FormatRemainingTime(secondsRemaining).</p>
                            }
                        </div>

                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" @onclick="ResendVerificationEmail" disabled="@(!canResendEmail || isSubmitting)">
                                @(isSubmitting ? "Sending..." : "Resend Verification Email")
                            </button>
                        </div>

                        <hr class="my-4" />

                        <h5>Change Email Address</h5>
                        <p class="text-muted">Made a typo? Update your email address below:</p>
                        
                        <div class="mb-3">
                            <label for="newEmail" class="form-label">New Email Address</label>
                            <InputText id="newEmail" class="form-control" @bind-Value="NewEmail" />
                        </div>
                        <button class="btn btn-outline-secondary w-100" @onclick="ChangeEmail" disabled="@isSubmitting">
                            @(isSubmitting ? "Updating..." : "Update Email & Send New Verification")
                        </button>
                    }
                    else
                    {
                        <EditForm Model="this" OnValidSubmit="HandleSubmit">
                            <DataAnnotationsValidator />
                            <ValidationSummary />

                            <div class="mb-3">
                                <label for="email" class="form-label">Email</label>
                                <InputText id="email" class="form-control" @bind-Value="Email" />
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">Password</label>
                                <InputText id="password" class="form-control" type="password" @bind-Value="Password" />
                                <small class="text-muted">Must be at least 8 characters and include upper, lower, digit, and symbol.</small>
                            </div>
                            <div class="mb-3">
                                <label for="confirm" class="form-label">Confirm Password</label>
                                <InputText id="confirm" class="form-control" type="password" @bind-Value="ConfirmPassword" />
                            </div>
                            <button type="submit" class="btn btn-primary w-100" disabled="@isSubmitting">
                                @(isSubmitting ? "Please wait..." : "Register")
                            </button>
                        </EditForm>
                    }
                </div>
            </div>
            <div class="mt-3 text-center">
                <a href="/login">Already have an account? Login</a>
            </div>
        </div>
    </div>
</div>

