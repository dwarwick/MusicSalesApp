@page "/reset-password"
@inherits ResetPasswordModel

<PageTitle>Reset Password</PageTitle>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <SfCard>
                <CardHeader Title="@(isSuccess ? "Password Reset Successful" : "Reset Password")" />
                <CardContent>
                    @if (isLoading)
                    {
                        <div class="text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Verifying your reset link...</p>
                        </div>
                    }
                    else if (isSuccess)
                    {
                        <SfMessage Severity="MessageSeverity.Success">
                            <h4>Password Changed!</h4>
                            <p>Your password has been successfully reset.</p>
                        </SfMessage>
                        <div class="mt-3 text-center">
                            <SfButton OnClick="@(() => NavigationManager.NavigateTo("/login"))" IsPrimary="true" Content="Login with New Password" CssClass="e-btn e-primary" />
                        </div>
                    }
                    else if (!isTokenValid)
                    {
                        <SfMessage Severity="MessageSeverity.Error">
                            <h4>Invalid or Expired Link</h4>
                            <p>@errorMessage</p>
                        </SfMessage>
                        <div class="mt-3 text-center">
                            <SfButton OnClick="@(() => NavigationManager.NavigateTo("/forgot-password"))" IsPrimary="true" Content="Request New Reset Link" CssClass="e-btn e-primary" />
                        </div>
                    }
                    else
                    {
                        @if (!string.IsNullOrEmpty(errorMessage))
                        {
                            <SfMessage Severity="MessageSeverity.Error">@errorMessage</SfMessage>
                        }

                        <p class="text-muted mb-4">Please enter your new password below.</p>

                        <EditForm Model="this" OnValidSubmit="HandleSubmit">
                            <DataAnnotationsValidator />

                            <div class="mb-3">
                                <label for="newPassword" class="e-label">New Password</label>
                                <SfTextBox @bind-Value="NewPassword" ID="newPassword" Type="InputType.Password" Placeholder="Enter new password" CssClass="e-outline" HtmlAttributes="@(new Dictionary<string, object> { { "required", "required" } })" />
                                <ValidationMessage For="@(() => NewPassword)" />
                                <small class="text-muted">Must be at least 8 characters and include upper, lower, digit, and symbol.</small>
                            </div>

                            <div class="mb-3">
                                <label for="confirmPassword" class="e-label">Confirm Password</label>
                                <SfTextBox @bind-Value="ConfirmPassword" ID="confirmPassword" Type="InputType.Password" Placeholder="Confirm new password" CssClass="e-outline" HtmlAttributes="@(new Dictionary<string, object> { { "required", "required" } })" />
                                <ValidationMessage For="@(() => ConfirmPassword)" />
                            </div>

                            <div class="d-grid">
                                <SfButton Type="ButtonType.Submit" IsPrimary="true" Disabled="@isSubmitting" Content="@(isSubmitting ? "Resetting..." : "Reset Password")" CssClass="e-btn e-primary" />
                            </div>
                        </EditForm>
                    }
                </CardContent>
            </SfCard>
            <div class="mt-3 text-center">
                <a href="/login">Back to Login</a>
            </div>
        </div>
    </div>
</div>
